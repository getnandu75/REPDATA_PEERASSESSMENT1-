
library(lattice)
if(!file.exists('activity.csv')){
  unzip('activity.zip')
}
activity <- read.csv('activity.csv')
time <- formatC(activity$interval / 100, 2, format='f')
activity$date.time <- as.POSIXct(paste(activity$date, time),
                                 format='%Y-%m-%d %H.%M',
                                 tz='GMT')
activity$time <- format(activity$date.time, format='%H:%M:%S')
activity$time <- as.POSIXct(activity$time, format='%H:%M:%S')
total.steps <- tapply(activity$steps, activity$date, sum, na.rm=TRUE)
mean(total.steps)
median(total.steps)
library(ggplot2)
qplot(total.steps, xlab='Total steps', ylab='Frequency')
mean.steps <- tapply(activity$steps, activity$time, mean, na.rm=TRUE)
daily.pattern <- data.frame(time=as.POSIXct(names(mean.steps)),
                            mean.steps=mean.steps)
library(scales)
ggplot(daily.pattern, aes(time, mean.steps)) + 
  geom_line() +
  xlab('Time of day') +
  ylab('Mean number of steps') +
  scale_x_datetime(labels=date_format(format='%H:%M'))
most <- which.max(daily.pattern$mean.steps)
format(daily.pattern[most,'time'], format='%H:%M')
summary(activity$steps)
library(Hmisc)
activity.imputed <- activity
activity.imputed$steps <- with(activity.imputed, impute(steps, mean))
total.steps.imputed <- tapply(activity.imputed$steps, 
                              activity.imputed$date, sum)
mean(total.steps)
mean(total.steps.imputed)
median(total.steps)
median(total.steps.imputed)
qplot(total.steps.imputed, xlab='Total steps', ylab='Frequency')
day.type <- function(date) {
  if (weekdays(date) %in% c('Saturday', 'Sunday')) {
    return('weekend')
  } else {
    return('weekday')
  }
}
day.types <- sapply(activity.imputed$date.time, day.type)
activity.imputed$day.type <- as.factor(day.types)
mean.steps <- tapply(activity.imputed$steps, 
                     interaction(activity.imputed$time,
                                 activity.imputed$day.type),
                     mean, na.rm=TRUE)
day.type.pattern <- data.frame(time=as.POSIXct(names(mean.steps)),
                               mean.steps=mean.steps,
                               day.type=as.factor(c(rep('weekday', 288),
                                                    rep('weekend', 288))))
ggplot(day.type.pattern, aes(time, mean.steps)) + 
  geom_line() +
  xlab('Time of day') +
  ylab('Mean number of steps') +
  scale_x_datetime(labels=date_format(format='%H:%M')) +
  facet_grid(. ~ day.type)

Enter file contents here
